(function(a){a.fn.twism=function(){var c=this;if(typeof arguments[0]==="string"){action=arguments[0];options=arguments[1]||null;callback=arguments[2]||null;}else{if(typeof arguments[0]==="object"){action="create";options=arguments[0];callback=arguments[1]||null;}else{if(typeof arguments[0]==="function"){action="create";options=null;callback=arguments[0];}else{action="create";options=null;callback=null;}}}var g=function(h,k){var j=c;c.remove();if(typeof k==="function"){k();}return;};var b=function(h,o,n,m,k,j,r){var q=document.createElementNS("http://www.w3.org/2000/svg","text");if(h&&typeof h.getBBox==="function"&&n&&m){var l=h.getBBox();q.setAttribute("transform","translate("+n+" "+m+")");q.textContent=o;q.setAttribute("id",o);q.setAttribute("fill",k);q.setAttribute("font-size",r);q.setAttribute("font-family",j);h.parentNode.insertBefore(q,h.nextSibling);}};var d=function(m,k,o,q,j,h,r){var l=document.createElementNS("http://www.w3.org/2000/svg","rect");p=document.getElementsByTagName("svg")[0];var n=p.viewBox.baseVal;l.setAttribute("id",m);l.setAttribute("fill",o);l.setAttribute("stroke",q);l.setAttribute("stroke-width","1");l.setAttribute("x",(p.getBBox().width-40));l.setAttribute("y",k);l.setAttribute("width","40");l.setAttribute("height","20");p.appendChild(l);b(l,m,p.getBBox().width-30,k+15,j,h,r);};var f=function(j,o){var l=a.extend({map:"world",customMap:false,territories:true,antarctica:false,color:"#A9DA8A",border:"white",align:"center",backgroundColor:"#4af",borderWidth:"2",height:null,width:null,click:function(q){if(q){alert(q);}},hover:function(){return;},hoverColor:"#BB0029",hoverBorder:"yellow",littleRedBook:true,hideCountries:false,disableCountries:[],individualCountrySettings:false,labels:false,labelAttributes:{color:"white",font:"Helvetica",fontSize:"15"}},j);var m=c;m.css({width:(l.width||"100%"),height:(l.height||"100%")});if(l.map=="world"){var k=(l.antarctica)?"world-map-with-antarctica.svg":"world-map.svg";}else{if(l.map=="usa"){var k="Blank_US_territories.svg";if(!l.territories){if(!l.hideCountries){l.hideCountries=[];}l.hideCountries.push("VI");l.hideCountries.push("GU");l.hideCountries.push("MP");l.hideCountries.push("AS");l.hideCountries.push("PR");}}else{if(l.map=="custom"){var h=l.customMap;}}}if(typeof(require)!=="undefined"&&l.map!="custom"){var n=k;h=require.toUrl("twism").replace("jquery.twism","maps/"+k);}else{if(!l.customMap){h="dist/maps/"+k;}else{h=l.customMap;}}m.load(h,null,function(t){a("svg",m).attr({height:m.height(),width:m.width()}).css({background:l.backgroundColor});var s=l.hideCountries;for(i in s){a("path#"+s[i]+", rect#"+s[i],m).remove();}if(l.labels&&l.map=="usa"){var v=document.querySelectorAll("path");var q=["NH","VT","MA","RI","CT","NJ","DE","MD","DC"];b(document.getElementById("HI"),"HI",300,575,l.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("AK"),"AK",110,500,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("FL"),"FL",755,511,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("SC"),"SC",752,380,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("GA"),"GA",700,405,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("AL"),"AL",645,415,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("NC"),"NC",767,332,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("TN"),"TN",647,345,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("ME"),"ME",885,86,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("NY"),"NY",807,155,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("PA"),"PA",770,211,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("WV"),"WV",735,275,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("KY"),"KY",665,305,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("OH"),"OH",694,236,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("MI"),"MI",650,175,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("WY"),"WY",293,181,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("MT"),"MT",273,86,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("ID"),"ID",183,151,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("WA"),"WA",116,48,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("TX"),"TX",404,452,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("CA"),"CA",65,280,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("AZ"),"AZ",193,364,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("NV"),"NV",132,251,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("UT"),"UT",216,248,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("CO"),"CO",317,272,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("NM"),"NM",297,373,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("OR"),"OR",96,118,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("ND"),"ND",408,92,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("SD"),"SD",408,163,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("NE"),"NE",408,223,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("IA"),"IA",523,214,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("MS"),"MS",588,418,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("IN"),"IN",644,255,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("IL"),"IL",590,260,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("MN"),"MN",495,116,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("WI"),"WI",574,151,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("MO"),"MO",535,294,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("AR"),"AR",537,375,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("OK"),"OK",432,361,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("KS"),"KS",439,291,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("LA"),"LA",538,456,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);b(document.getElementById("VA"),"VA",778,282,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);var u=200;_.each(q,function(w){d(w,u,l.color,l.borderColor,l.labelAttributes.color,l.labelAttributes.font,l.labelAttributes.fontSize);u=u+25;});}a("svg path, svg rect",m).css({fill:l.color,stroke:l.border,strokeWidth:l.borderWidth});var r=l.individualCountrySettings;for(i in r){a("svg path#"+r[i].name+", svg rect#"+r[i].name,m).css({fill:r[i].color||l.color,stroke:r[i].border||l.border});}a("svg",m).on("click",function(w){lastclicked=a(w.target).attr("id");l.click(lastclicked);});a("svg path, svg rect, svg text",m).on("mouseover",function(x){if(r&&r.length){var w=a.map(r,function(z){return z.name;});}var y=a(x.target).attr("id");if(l.disableCountries&&l.disableCountries.indexOf(y)==-1){if(r&&w.indexOf(y)>-1){for(i in r){if(r[i].name==y){a("svg path#"+r[i].name+", svg rect#"+r[i].name,m).css({fill:r[i].hoverColor||l.hoverColor,stroke:r[i].hoverBorder||l.hoverBorder});}}}else{a("path#"+y+", rect#"+y,m).css({fill:l.hoverColor,stroke:l.hoverBorder});}if(l.littleRedBook){if(y=="cn"||y=="tw"||y=="hk"||y=="mc"){a("path#tw, path#cn, path#hk, path#mc").css({fill:l.hoverColor,stroke:l.hoverBorder});}}}});a("svg path, svg text, svg rect",m).on("mouseout",function(w){var x=a(w.target).attr("id");a("path#"+x+", rect#"+x,m).css({fill:l.color,stroke:l.border});for(i in r){a("svg rect#"+r[i].name+", svg path#"+r[i].name,m).css({fill:r[i].color||l.color,stroke:r[i].border||l.border});}if(l.littleRedBook){if(x=="cn"||x=="tw"||x=="hk"||x=="mc"){a("path#tw, path#cn, path#hk, path#mc").css({fill:l.color,stroke:l.border});}}});if(typeof o==="function"){o();}});return m;};var e=function(h){if(h.color){a("svg path#"+h.name+", svg rect#"+h.name).css({fill:h.color});a("svg path#"+h.name+", svg rect#"+h.name).on("mouseout",function(){a(this).css({fill:h.color});});}if(h.border){a("svg path#"+h.name+", svg rect#"+h.name).css({stroke:h.border});a("svg path#"+h.name+", svg rect#"+h.name).on("mouseout",function(){a(this).css({stroke:h.border});});}if(h.borderWidth){a("svg path#"+h.name+", svg rect#"+h.name).css({strokeWidth:h.borderWidth});}if(h.hoverColor){a("svg path#"+h.name+", svg text#"+h.name+", svg rect#"+h.name).on("mouseover",function(j){a("svg path#"+h.name).css({fill:h.hoverColor});if(h.hoverBorder){a("svg path#"+h.name+", svg text#"+h.name+", svg rect#"+h.name).css({stroke:h.hoverBorder});}});a("svg path#"+h.name+", svg text#"+h.name+", svg rect#"+h.name).on("mouseout",function(j){a("svg path#"+h.name).css({fill:h.color});if(h.hoverBorder){a("svg path#"+h.name+", svg text#"+h.name+", svg rect#"+h.name).css({stroke:h.border});}});}if(h.click){a("svg path#"+h.name+", svg text#"+h.name+", svg rect#"+h.name).on("click",function(j){j.stopPropagation();lastclicked=a(j.target).attr("id");h.click(lastclicked);});}if(h.hover){a("svg path#"+h.name+", svg text#"+h.name+", svg rect#"+h.name).on("mouseover",function(j){j.stopPropagation();lastclicked=a(j.target).attr("id");h.hover(lastclicked);});}};switch(action){case"create":return f(options,callback);break;case"destroy":return g(options,callback);break;case"setCountry":return e(options);break;default:return f(options,callback);}};}(jQuery));